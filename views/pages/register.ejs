<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register Page</title>
    <%- include ('../partials/links') -%>
    <link rel="stylesheet" href="/css/login.css">
</head>

<body>
    <script>
        $(document).ready(function(){
            $("#register_user").on('click',function(e){
                
                e.preventDefault();
                let user_name = $("#user_name").val();
                let u_email_id = $("#u_email_id").val();
                let userpassword = $("#userpassword").val();
                let mobileno = $("#mobileno").val();
                let tags = $("#tags").val();
                let diagnosed = $("#diagnosed").val();
                let url = "/register_user"
                $.post(url,{user_name:user_name, u_email_id:u_email_id, userpassword:userpassword, mobileno:mobileno, tags:tags, diagnosed:diagnosed}).done(function(data){
                    if(data.login == "Login Successful"){
                        let geturl = data.redirect;
                        $(location).attr('href',geturl);
                    }
                    else if(data == "Invalid Credentials"){
                        swal({
                            title:"Invalid Credentials",
                            text:"Username/Password Incorrect",
                            icon:"warning",
                            dangerMode:true,
                        }).then((willDelete) => {
                            if (willDelete) {
                                let geturl = "/login";
                                $(location).attr('href',geturl);
                            }
                    })
                    }
                    else{}
                })
            })
        })
    </script>
    <div id="formdiv">
        <form action="/register" class="forms" id="registerform" method="POST">
            <h2 class="full">Register</h2>
            <label for="username">Username</label>
            <input type="text" name="username" placeholder="Enter a username..." id="user_name">
            <label for="useremail">Your email</label>
            <input type="email" name="email" placeholder="Enter Your email-id" id="u_email_id">
            <label for="userpassword">Password</label>
            <input type="password" name="userpassword" id="userpassword" placeholder="Enter Your password">
            <label for="confirmpassword">Confirm Password</label>
            <input type="password" name="comfirmpassword" id="comfirmpassword" placeholder="Retype your password">
            <label for="mobileno">Mobile No.</label>
            <input type="number" name="mobileno" id="mobileno" placeholder="Enter Your mobile no.">
            <label for="tags">Interested topics</label>
            <input type="text" name="tags" id="tags" placeholder="Enter topics you are interested in" list="taglist">
            <datalist id="taglist">
                <option value="Alzheimer">
                <option value="Obesity">
                <option value="Anxiety">
                <option value="Depression">
            </datalist>
            <div id="selectedtags" class="full">

            </div>
            <label for="accounttype">Choose an account type:</label>
            <select name="accounttype" id="accounttype" onchange="setusertype($(this))">
                <option value="user" selected>User</option>
                <option value="doctor">Doctor</option>
            </select>
            <label for="diagnosed">Diagnosed with</label>
            <input type="text" name="diagnosed" id="diagnosed" placeholder="Enter the disease you are diagnosed with">
            <label for="certificate" style="display:none;">Upload Your Certificate</label>
            <input type="file" name="certificate" id="certificate" style="display:none;">
            <input type="submit" class="searchbutton full" id="register_user" value="Register">
        </form>
    </div>
    <script>
        function setusertype(t){
            var v = t.val();
            if(v == "user"){
                $('#diagnosed').show().prev().show();
                $('#certificate').hide().prev().hide();
            }
            else if(v == "doctor"){
                $('#certificate').show().prev().show();
                $('#diagnosed').hide().prev().hide();
            }
        }
        $(document).ready(function(){
            $('#tags').on('input', function(){
                var v = this.value;
                if($('#taglist option').filter(function(){
                    return this.value.toUpperCase() === v.toUpperCase();        
                }).length){
                    var str = '<div class="alert alert-warning alert-dismissible fade show tagspan" role="alert"><span>'+v+'</span><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>';
                    $('#selectedtags').append(str);
                }
            });
            $('#tags').click(function(){
                $(this).select();
            });
        });
    </script>
</body>

</html>